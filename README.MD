This is a [Next.js](https://nextjs.org/) project bootstrapped with [`create-next-app`](https://github.com/vercel/next.js/tree/canary/packages/create-next-app).

# Point App


## ğŸ–¥ Interface
### Front
- íšŒì›ê°€ì…, ë¡œê·¸ì¸
- Point ì¹´ë“œ ë“±ë¡, ì¡°íšŒ
- Point ì ë¦½, ì‚¬ìš© ë‚´ì—­ í™•ì¸, ì¡°íšŒ 
- Point ì‚¬ìš©ê°€ëŠ¥ì²˜ ì¡°íšŒ (Map)


### Backend
- íšŒì› ê´€ë¦¬(ë“±ë¡, ì‚­ì œ, ê¸°ë³¸ì •ë³´, í¬ì¸íŠ¸ ë‚´ì—­)
- Point ì¹´ë“œ ê´€ë¦¬(ë“±ë¡, ì‚­ì œ)
- ì‚¬ìš©ê°€ëŠ¥ì²˜ ë“±ë¡(Map)


## â³ History

### ğŸ“† June, 2024
#### Session ì •ë³´ display ì´ìŠˆ
- Nextauth (í˜„ì¬ 4.x) ê°€ 5.x ë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ë˜ë©´ì„œ ì„œë¹„ìŠ¤ ëª…ì¹­ì´ [Auth.js](https://authjs.dev/) ìœ¼ë¡œ ë°”ë€Œì—ˆë‹¤. ì•„ì§ê¹Œì§€ëŠ” 5ë²„ì „ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ í•˜ì§€ ì•ŠìŒ ìƒíƒœ.
- ì¸ì¦ì„ í•˜ê³  session ì´ í’€ë¦¬ëŠ” í˜„ìƒì´ ìˆìŒ. (ìƒˆë¡œê³ ì¹¨ ë“±)
- session ë”œë ˆì´: ì¸ì¦ session ì·¨ë“ í›„ next/link ë¥¼ í†µí•œ ì¸í„°ë„ í˜ì´ì§€ ì´ë™ì—ì„œëŠ” ë³´ì´ì§€ ì•Šìœ¼ë‚˜ ìƒˆë¡œê³ ì¹¨ì„ í–ˆì„ ê²½ìš° session ì·¨ë“ ì´ì „ì˜ UI (Sign In, Log In ë²„íŠ¼ ë“±)ì´ ì•½ 1~2ì´ˆ ì •ë„ ë³´ì¸ í›„ session ì´ ì ìš©ëœ UI (ìœ ì €ë„¤ì„, Log Out)ê°€ ë³´ì´ëŠ” í˜„ìƒì´ ìˆìŒ.
- SSR ì´ìŠˆì¸ê°€? Nextauthì˜ ë²„ê·¸ì¸ê°€? 5.x ë¡œ ì—…ë°ì´íŠ¸ í•˜ë©´ í•´ê²°ë˜ëŠ” ê²ƒì¸ì§€? í˜„ì¬ë¡œì¨ëŠ” ì¢€ ë” í™•ì¸í•´ ë´ì•¼ í•  ë¬¸ì œê°™ë‹¤.
- Auth.js ì—ì„œ session prefetch ê¸°ëŠ¥ì´ ìˆë‹¤. Roor ì»´í¬ë„ŒíŠ¸ Provider ì—ì„œ session ì´ë€ props ë¥¼ í†µí•´ route ì´ë™ì‹œì— ë¯¸ë¦¬ session ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆëŠ”ê°€ëŠ” ê°œë…ê°™ì€ë°, SessionProvider ì—ì„œ ì´ ë¶€ë¶„ì´ ì´ë¯¸ ì ìš©ë˜ì–´ ìˆëŠ”ê±° ì•„ë‹ˆì—ˆë‚˜? ì´ ë¶€ë¶„ì€ ì¢€ ë” í™•ì¸í•„ìš”í•¨.
- ì¼ë‹¨ì€ Session status ì˜ Loading ìƒíƒœë¡œ ì¤‘ê°„ì— ìƒê¸°ëŠ” ë”œë ˆì´ ì¤‘ì— í•´ë‹¹ UI ë¶€ë¶„ì— ìŠ¤ì¼ˆë ˆí†¤ UIë¥¼ ì ìš©í•´ì„œ ë¡œë”© UIë¥¼ í‘œí˜„í•¨.
```javascript
// Session status 'Loading' ì¼ ë•Œ ë³´ì—¬ ì¤„ UI ê°ì²´
const loadingAnimation = keyframes`
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
`;

const SkeletonSpan = styled.span<{ width: string, height: string, margin: string }>`
    display: block;
    background: linear-gradient(90deg, #DADADA, #f5f5f5, #DADADA);
    background-size: 200% 100%;
    animation: ${loadingAnimation} 1.5s infinite;
    width: ${props => props.width};
    height: ${props => props.height};
    margin: ${props => props.margin};
    border-radius: 8px;
`;

// Header.tsx 
const showSession = () => {
    if (status === "authenticated") {
      return (
        <>
          ...
        </>
      )
    } else if (status === "loading") {
      return (
        <>
          <SkeletonSpan width="68px" height="32px" margin="0 0 0 16px"/>
          <SkeletonSpan width="64px" height="32px" margin="0 0 0 16px"/>
        </>
      )
    } else {
      return (
        <>
          ...
        </>
      )
    }
  }
```
   
   <img src="./public/session-loading.png" alt="" />

### ğŸ“† June 5, 2024
#### NextAuth.js êµ¬í˜„ê³¼ ì˜¤ë¥˜ í•´ê²°
- ì‚¬ìš©ìì¸ì¦ì„ [NextAuth.js](https://next-auth.js.org/getting-started/introduction) ë¡œ ì ìš©í•˜ê¸°ë¡œ í•¨.
- ê³µì‹ì‚¬ì´íŠ¸ì—ì„œëŠ” Next.js ì„ ìœ„í•œ ì™„ì „í•œ ì˜¤í”ˆ ì†ŒìŠ¤ë¡œ ì†Œê°œí•˜ê³  ìˆë‹¤.
- ì¸ì¦ì„ êµ¬í˜„í•˜ëŠ” resource ë“¤ì´ ì˜ì •ë¦¬ë˜ì–´ ìˆë‹¤. [Get Started](https://next-auth.js.org/getting-started/example)

### ì‹œì‘í•˜ë©°
- NextAuth.js ëŠ” ```/api/auth``` path ì•ˆì—ì„œ ì¸ì¦ì„ ì²˜ë¦¬í•œë‹¤.
- /app/api/auth/[...nextauth]/route.ts ë¼ìš°íŠ¸ë¥¼ ë§Œë“¤ì–´ GET, POST method ë¥¼ ë§¤í•‘í•˜ëŠ” handler ë¥¼ ë§Œë“¤ì–´ ì¤€ë‹¤. (Next.js 14 ê¸°ì¤€)
- [...] ì€ ë™ì  ë¼ìš°íŒ…ì„ ì˜ë¯¸í•¨. signIn, signOut, callback ë“±ì˜ ìš”ì²­ì´ ì—¬ê¸°ë¥¼ í†µí•´ ì²˜ë¦¬ëœë‹¤. auth.ts ë¥¼ ì—°ê²°í•´ì„œ ì¸ì¦ë¶€ë¶„ê¹Œì§€
> All requests to /api/auth/*(signIn, callback, signOut, etc.) will automatically be handled by NextAuth.js.
  
- /api/auth/* ë¡œ ë“¤ì–´ì˜¤ëŠ” api ìš”ì²­ì€ /api/auth/[...nextauth]/route.ts ì—ì„œ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ ì¤€ë‹¤ëŠ” ê²ƒì´ë‹¤.

```javascript
// app/api/auth/[...nextauth]/route.ts
import { authOptions } from "@/libs/auth";
import NextAuth from "next-auth";

const handler = NextAuth(authOptions);

export {
    handler as GET, handler as POST
}
```
- ì¸ì¦ì„ ì²˜ë¦¬í•˜ëŠ” auth.ts ë¥¼ ì‘ì„±í•œë‹¤. ë‚˜ëŠ” ```/app/lib/auth.ts``` ë¡œ ì‘ì„±


```javascript
// /app/lib/auth.ts

export const authOptions: NextAuthOptions = {
    providers: [
        GoogleProvider({
            clientId: process.env.GOOGLE_CLIENT_ID as string,
            clientSecret: process.env.GOOGLE_CLIENT_SECRET as string,
        }),
        CredentialsProvider({
            name: "Credentials",
            id: "credentials",
            credentials: {
                email: { label: "Email", type: "text", placeholder: "Email" },
                password: { label: "Password", type: "password" },
            },
            async authorize(credentials, req): Promise<any> {
                await connectDB();
                const userFound = await User.findOne({
                    email: credentials?.email,
                }).select("+password");

                if (!userFound) throw new Error("Invalid Email");

                const passwordMatch = await bcrypt.compare(
                    credentials!.password,
                    userFound.password,
            );

                if (!passwordMatch) throw new Error("Invalid Password");
                return userFound;
            },
        }),
    ],
// ìƒëµ
```
- ê¸°ë³¸ì ìœ¼ë¡œ email ê³¼ ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ì„ ì œê³µí•œë‹¤. êµ¬ê¸€ OAuth ë„ ì œê³µí•œë‹¤.
- provider ë¡œ êµ¬ê¸€, ê¹ƒí—ˆë¸Œ ê°™ì€ OAuth ì¸ì¦, ê¸°ë³¸ì ì¸ credentials ì™€ ê°™ì€ ìê²©ì¦ëª…ì¸ì¦(email ë˜ëŠ” ID ì™€ ë¹„ë°€ë²ˆí˜¸)ì„ ì œê³µí•œë‹¤. 
- ```CredentiaslProvider``` ì—ì„œëŠ” ```credentials``` í”„ë¡œí¼í‹°ë¥¼ í†µí•´ ì¸ì¦ì„ ìœ„í•´ ì–´ë–¤ ì •ë³´ë¥¼ ì…ë ¥ë°›ì„ì§€ ì§€ì •í•  ìˆ˜ ìˆë‹¤. (email or user id)
- ìœ„ì—ì„œ ì…ë ¥ë°›ì€ í”„ë¡œí¼í‹° ê°’ì„ ê°€ì§„ ê°ì²´ê°€ authorize ì½œë°± í•¨ìˆ˜ì— ì²«ë²ˆì§¸ ì¸ìˆ˜ë¡œ ì „ë‹¬ë¨(HTTP POST) ê·¸ëŸ¬ë©´ ì‚¬ìš©ìê°ì²´(email, name, _id ë“±), ë˜ëŠ” null, Error ì¤‘ í•˜ë‚˜ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì´ë‹¤.
- 

### ğŸ“† June 4, 2024
#### ì‚¬ìš©ì ë“±ë¡ ë¡œì§
- ì‚¬ìš©ì ë“±ë¡ì„ ìœ„í•œ ë¡œì§ì„ êµ¬í˜„í•œë‹¤. í”„ë¡ íŠ¸ì—ì„œ ì…ë ¥ë°›ì€ ë°ì´í„°ë¥¼ ë°±ì—”ë“œë¡œ ë³´ë‚´ê³  ë°±ì—”ë“œì—ì„œëŠ” í•´ë‹¹ ë°ì´í„°ì˜ ëª¨ë¸ì„ í†µí•´ ê²€ì¦í•œ í›„ dbì— ì ‘ì† -> ì €ì¥í•˜ê²Œ ëœë‹¤.  

#### Backend
- TODO: ì‚¬ìš©ì ì´ë©”ì¼ ì¤‘ë³µì²´í¬, ë°ì´í„° ëª¨ë¸ ì •ì˜ê°€ í•„ìš”í•˜ë‹¤. 
- bcryptë¡œ passwordë¥¼ ì•”í˜¸í™” í–ˆë‹¤.

```javascript
export async function POST(request: NextRequest) {
    try {
        const client = await connect;
        const body = await request.json();
        
        const salt = await bcrypt.genSalt(10);
        const hashedPassword = await bcrypt.hash(body.password, salt);

        await client.db("test").collection("users").insertOne({
            name: body.name,
            email: body.email,
            password: hashedPassword
        });
        
        return NextResponse.json({
            message: "successfully updated the document",
            success: true,
        })
    } catch (error: any) {
        return NextResponse.json({ error: error.message }, { status: 500 })
    }
}
```
  
#### Frontend
- onSubmit ì´ë²¤íŠ¸ë¡œ í¼ì„ ì „ì†¡í•˜ê³ , ```event.preventDefault()``` ë¡œ í¼ì´ ë¬´ì‘ì • ì „ì†¡ë˜ëŠ”ê±¸ ë§‰ëŠ”ë‹¤.
- ì…ë ¥ê°’ validator í•„ìš”í•¨.
- ì¸ì¦ ë¡œì§ì´ ì™„ì„±ë˜ë©´ ì¸ì¦ì—¬ë¶€ì— ë”°ë¥¸ ì ‘ê·¼ ì—¬ë¶€ ì‘ì—…ë„ í•„ìš”(Router).

```javascript
const [email, setEmail] = useState<string>("");
const [name, setName] = useState<string>("");
const [password, setPassword] = useState<string>("");

const userInput = {
    email,
    name,
    password,
}

const submitHandler = async (event) => {
    event.preventDefault();
    try {
        const { data, status } = await axios.post("/api/users/regist", userInput, {
            headers: {
                'Content-Type': 'application/json'
            }
        });

        if (status === 200) {
            router.push("/member/login")
        }
    } catch (error) {
        console.log(error.message)
    }
}

<form onSubmit={submitHandler}>
    <InputGroup 
        inputId="email"
        type="email"
        label="ì´ë©”ì¼"
        title="Email"
        required={true}
        value={email}
        placeholder="Email"
        className="input-text"
        onchange={(e) => setEmail(e.target.value)}
    />
    .
    .
    .
    <Input
        type="submit"
        value="Submit"
        className="input-button submit"
    />
</form>
```

ì¼ë‹¨ ë“±ë¡ì€ ì •ìƒì ìœ¼ë¡œ ëœë‹¤. 


### ğŸ“† May 31, 2024

#### ì¸ì¦ ë¡œì§ êµ¬í˜„
- bcrypt, jsonwebtoken íŒ¨í‚¤ì§€ë¡œ ìœ ì €ë“±ë¡ì‹œ ë³´ë‚´ëŠ” ë°ì´í„°ë¥¼ ì•”í˜¸í™”í•˜ê³  ì›¹í† í°ì„ ë§Œë“¤ì–´ì„œ ìœ ì €ì˜ ë°ì´í„°ë¥¼ ê²€ì¦í•˜ê³  ì¸ì¦í•  ê²ƒ ì´ë‹¤.

### ğŸ“† May 30, 2024
#### UI loading
Nextjs App Router ì—ì„œëŠ” ì•½ì†ëœ íŒŒì¼ ì¤‘(layout, page, route ë“±ë“±) í•˜ë‚˜ì¸ loading.ts ë¼ëŠ” íŒŒì¼ì´ ìˆë‹¤. ì´ëŠ” í˜ì´ì§€ê°„ ì´ë™ ì‹œ ë Œë”ë§ì´ ë˜ëŠ” ë™ì•ˆ ëŒ€ì²´ë˜ëŠ” ui ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆë‹¤.  
ì»´í¬ë„ŒíŠ¸ë³„ë¡œë„ ì ìš©í•  ìˆ˜ ìˆë‹¤.  
layout.tsxì™€ page.tsx ì™€ ê°™ì€ ê²½ë¡œì— ë§Œë“¤ì–´ ë‘ë©´ í•´ë‹¹ layout.tsx ë¡œ ë©í•‘ë˜ì–´ ìˆëŠ” í™”ë©´ ë° ì»´í¬ë„ŒíŠ¸ëŠ” ëª¨ë‘ ìë™ ì ìš©ëœë‹¤.  
<img src="https://nextjs.org/_next/image?url=%2Fdocs%2Flight%2Floading-special-file.png&w=1920&q=75" width="480" alt="loading.js" />  
```Suspense``` ë¥¼ í†µí•´ ì»´í¬ë„ŒíŠ¸ ë³„ë¡œ ë¡œë”© UIë¥¼ ìˆ˜ë™ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.  

<img src="https://nextjs.org/_next/image?url=%2Fdocs%2Flight%2Floading-overview.png&w=1920&q=75" width="480" alt="Suspense" />  
  
- loading.tsx íŒŒì¼ì„ ìµœìƒë‹¨ì˜ page.tsx ì™€ ê°™ì€ ê²½ë¡œì— ë‘ì–´ ê³µí†µ ë¡œë”© UIë¡œ ì ìš©í•¨. í˜ì´ì§€ê°„ ì´ë™ì‹œì— ì ìš©ë˜ëŠ” ê²ƒì´ í™•ì¸ë¨. (í”„ë¡œì íŠ¸ ì´ˆê¸° ë‹¨ê³„ë¼ í˜ì´ì§€ ë Œë”ë§ì´ ë¹¨ë¼ì„œ ì¸ì§€ ê±°ì˜ ë³´ì´ì§€ ì•ŠìŒ)
- ```<Suspense><Component /></Suspense>``` ì‚¬ìš©í•´ ë³´ì•˜ìœ¼ë‚˜ ì ìš©ì´ ì•ˆë˜ëŠ”ê±° ê°™ìŒ... ì´ìœ ëŠ” í™•ì‹¤íˆ ëª¨ë¥´ê² ë‹¤. react developer tools ë¡œ ë§ˆìš´íŠ¸ ëœ components ë¥¼ ë³´ë©´ ```<Suspense>```ê°€ ì¡´ì¬í•¨. 
- loading.tsc ë¥¼ ì‚¬ìš©í•´ì„œ ë°ì´í„° íŒ¨ì¹˜ ìƒíƒœì— ë”°ë¥¸ ë¡œì§ì„ êµ¬í˜„.
```TypeScript
// loading ìƒíƒœ ì¶”ê°€
const [loading, setLoading] = useState<boolean>(true);

const getUsersHandler = async () => {
    try {
        const res = await axios.get("/api/users/");
        
        if (res.status === 200) {
            setUsers(res.data);
            setLoading(false); // data ê°€ ì„±ê³µì ìœ¼ë¡œ íŒ¨ì¹˜ë˜ë©´ ë¡œë”© ê°ì¶¤
        }
    } catch(error) {
        setError(true);            
        setLoading(false);
        setErrMsg(
            error.reponse && error.response.data.message
            ? error.response.data.message
            : error.message
        );
        console.log(error.message);
    }
    
}

 if (loading) return <Loading />;

 return (
    <>
        ... 
    </>
 )

```



### ğŸ“† May 29, 2024

ì €ì¥ëœ ìœ ì €ë“¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°  
users collection ì— ì €ì¥ëœ ì €ë“¤ì˜ ë°ì´í„°(document)ë¥¼ front í™”ë©´ì—ì„œ í˜¸ì¶œí•˜ê¸°  
- app/api/users/route.ts ì— ìœ ì €ë°ì´í„°ë¥¼ í˜¸ì¶œí•˜ëŠ” ì½˜íŠ¸ë¡¤ëŸ¬ë¥¼ ë§Œë“¤ì–´ /api/users API endpoint ìƒì„±
```javascript
// app/api/users/route.ts
// /api/users
export async function GET(req: NextRequest) {
    const client = await connect;
    const usersData = await client.db("test").collection("users").find();
    const getUsers = await usersData.toArray();

    return NextResponse.json(getUsers);
}

// app/member/users/page.tsx
// /member/users
const [users, setUsers] = useState([]);

const getUsersHandler = async () => {
    try {
        const { data, status } = await axios.get("/api/users/");
        if (status === 200) {
            setUsers(data);
        }
    } catch(error) {
        console.log(error.message);
    }
    
}

useEffect(() => {
    getUsersHandler();
}, []);

return (
    <>
        <ul>
            {users && users.map((user) => (
                <li key={user._id}>
                    {user.name}({user.email})
                </li>
            ))}
        </ul>
    </>
)
```
[í”„ë¡ íŠ¸ í™”ë©´]  
<img src="./public/users-front.png" alt="" />


### ğŸ“† May 29, 2024

DB ì €ì¥ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€  
Backend ì—ì„œ ìœ ì €ë°ì´í„° email, name ì„ users collection ì— ì €ì¥í•  ìˆ˜ ìˆëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ì¶”ê°€í•œë‹¤.  
Front í™”ë©´ì—ëŠ” email, name ë°ì´í„°ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆëŠ” form ì„ ë§Œë“ ë‹¤. (ì‹ ê·œìœ ì € ë“±ë¡ì„ ìœ„í•´ì„œëŠ” password ë„ í•„ìš”í•˜ë‹¤. password ëŠ” ì•”í˜¸í™” ë¡œì§ë„ í•„ìš”) 
Front ì—ì„œëŠ” ìœ ì €ë°ì´í„°ë¥¼ /api/users/regist api ë¥¼ í˜¸ì¶œí•˜ì—¬ dbì— ì €ì¥í•˜ê²Œ ëœë‹¤.
```javascript
// app/api/users/regist/route.ts
export async function POST(request: Request) {
    const client = await connect;
    const body = await request.json();
    await client.db("test").collection("users").insertOne({
        email: body.userEmail,
        name: body.userName,
    });
    return Response.json({
        message: "successfully updated the document"
    })
}

// app/member/join/page.tsx
const submitHandler = () => {
    fetch("/api/users/regist", {
        method: "POST",
        body: JSON.stringify({
            userEmail, 
            userName, 
            userPassword
        })
    })
}

// <InputGroup> ì€ input ê³¼ label ë“±ìœ¼ë¡œ êµ¬ì„±ëœ ì»´í¬ë„ŒíŠ¸ 
<form onSubmit={submitHandler}>
    <InputGroup 
        inputId="userEmail"
        type="email"
        title="Email"
        required={true}
        value={userEmail}
        placeholder="Email"
        onchange={(e) => setUserEmail(e.target.value)}
    />
    <InputGroup 
        inputId="userName"
        type="text"
        title="Name"
        required={true}
        value={userName}
        placeholder="Name"
        onchange={(e) => setUserName(e.target.value)}
    />

    <Input
        type="submit"
        value="Submit"
    />
</form>
```
[ì…ë ¥í™”ë©´]  
<img src="./public/form1.png" width="320" alt="" />

[Form ì „ì†¡ê²°ê³¼]  
<img src="./public/mongo-db-users2.png" alt="" />


### ğŸ“† May 28, 2024

MongDBì— ì—°ê²°í•˜ê³  ë°ì´í„°ë¥¼ POST, GET í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œ.  
- API route ì˜ ê¸°ë³¸ì½”ë“œ
```javascript
const { MongoClient, ServerApiVersion } = require("mongodb");

// Replace the placeholder with your Atlas connection string
const uri = "<connection string>";

// Create a MongoClient with a MongoClientOptions object to set the Stable API version
const client = new MongoClient(uri,  {
        serverApi: {
            version: ServerApiVersion.v1,
            strict: true,
            deprecationErrors: true,
        }
    }
);

async function run() {
  try {
    // Connect the client to the server (optional starting in v4.7)
    await client.connect();

    // Send a ping to confirm a successful connection
    await client.db("admin").command({ ping: 1 });
    console.log("Pinged your deployment. You successfully connected to MongoDB!");
  } finally {
    // Ensures that the client will close when you finish/error
    await client.close();
  }
}
run().catch(console.dir);

```
  
dbì— ì ‘ì†í•œ í›„ ë°ì´í„°ë¥¼ ë³´ë‚´ëŠ” í…ŒìŠ¤íŠ¸ í˜ì´ì§€ë¥¼ ì¶”ê°€.  
```javascript
// api/users/regist/route.ts
// /api/users/regist entpointê°€ ìƒì„±ë¨

export async function POST(request: Request){
    const client = await connect;
    const cursor = await client.db("test").collection("users").insertOne({
        email:"vuenos@gmail.com",
        name: "Jintae Kim",
        Age: "22"
    });
    return Response.json({message: "successfully updated the document"})
}

// app/test/page.tsx
export default function TestApi() {
    useEffect(() => {
        fetch("/api/users/regist", {
            method: "POST"
        })
    }, []);

    return (
        <h1>Some Content</h1>
    )
}
```

ì´ëŸ¬ë©´ http://localhost:3000/test ì ‘ì†ì‹œ  
MongoDB ì˜ 'test' db ì˜ 'users' collection ì— email, name, age ë°ì´í„°ë¥¼ ì €ì¥í•¨.

- ```insertOne``` : ë‹¨ì¼ document ë¥¼ collection ì— ì €ì¥
- ```insertMany``` : ë‹¤ì¤‘ document ë¥¼ collection ì— ì €ì¥  

[ì°¸ê³ ] https://www.mongodb.com/ko-kr/docs/manual/reference/method/db.collection.insertOne/


[ê²°ê³¼]
<img src="./public/mongo-db-users.png" alt="" />

[ì°¸ê³ ]  
- https://www.mongodb.com/ko-kr/docs/atlas/device-sdks/web/nextjs/
- https://www.mongodb.com/docs/drivers/node/current/fundamentals/connection/connect/#std-label-node-connect-to-mongodb
- https://ellertsmarik.medium.com/json-api-using-next-js-13-and-mongodb-f45e8e61b031

### ğŸ“† May 22, 2024
#### MongoDB ì„¸íŒ…
DBëŠ” ëª½ê³ ë””ë¹„ë¥¼ ì‚¬ìš©í•˜ê¸°ë¡œ í–ˆë‹¤.  
ë“±ë¡, ì¡°íšŒ ì˜ ê¸°ëŠ¥ì´ ëŒ€ë¶€ë¶„ì´ë¼ ë¬´ë¦¬ ì—†ì–´ ë³´ì˜€ë‹¤.  
db,collectionì„ ìƒì„±
<img src="./public/mg-db-test.png" alt="" /> 


### ğŸ“† May 20, 2024
Express ë¡œ ë°±ì—”ë“œë¥¼ êµ¬ì„±.í–ˆì„ë•Œ  
í”„ë¡ íŠ¸ì™€ ë³„ê°œë¡œ ì„œë²„í˜¸ìŠ¤íŒ…ì„ êµ¬ì„±í•´ì•¼ í•œë‹¤  
vercel ë¡œ deploy í•˜ì—¬ production ìƒíƒœë¡œ ë§Œë“¤ì–´ì„œ ì˜¨ë¼ì¸ìœ¼ë¡œ ì ‘ì†í•´ ë³´ë©´ í”„ë¡ íŠ¸ëŠ” ì •ìƒì ìœ¼ë¡œ ë³´ì´ì§€ë§Œ  
API ë¥¼ í˜¸ì¶œí–ˆì„ë•Œ í†µì‹ ì´ ë˜ì§€ ì•ŠëŠ”ë‹¤. ë°±ì—”ë“œ ë¦¬ì†ŒìŠ¤ë¥¼ ë³„ë„ë¡œ í˜¸ìŠ¤íŒ… í•˜ì—¬ í˜¸ì¶œí•´ì•¼ í•˜ëŠ” ê²ƒì´ë‹¤.  
- Next.js ë¡œ ê°œë°œí•˜ëŠ”ë° Express ë¡œ ë°±ì—”ë“œë¥¼ ë³„ë„ë¡œ êµ¬ì„±í•˜ê¸° ë³´ë‹¤ Next.js ì˜ [Route Handlers](https://nextjs.org/docs/app/building-your-application/routing/route-handlers) ë¡œ endpoint ë¥¼ ë§Œë“¤ë©´ ë˜ê² ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.
- route êµ¬ì„±ì€ í”„ë¡ íŠ¸ì™€ ë™ì¼í•˜ë‹¤. /app/api/users/route.ts ëŠ” /api/users ë¼ëŠ” endpoint ë¥¼ ë§Œë“¤ì–´ ì¤€ë‹¤.
- /app/api/users/route.ts ì— í˜¸ì¶œì‹œ ë°˜í™˜ë˜ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ì‘ì„±í•´ ì£¼ë©´ ëœë‹¤.
- GET, POST ë¼ëŠ” í•¨ìˆ˜ëª…ì´ ê·¸ëŒ€ë¡œ ê·¸ ì—­í™œì„ ìˆ˜í–‰í•´ ì¤€ë‹¤.  

```javascript
// /app/api/users/route.ts
import {NextRequest, NextResponse} from "next/server";

export async function GET(req: NextRequest) {
    return NextResponse.json({
        name: "Jintae Kim",
        email: "vuenos@gmail.com",
        isAdmin: true,
    })
}

// /app/page.tsx
const callDataHandler = async () => {
    try {
      const { data, status } = await axios.get(`${url}/test`);

      if (status === 200) {
        setUserData(data);
        setCallStatus("suceess");
        setMsg(`ì„œë²„ì—ì„œ ì •ìƒì ìœ¼ë¡œ ì‘ë‹µí•¨`);
      }
    } catch(error: any) {
      console.log(error.message)
      setCallStatus("failed");
      setMsg(`ì„œë²„ í†µì‹  ì‹¤íŒ¨`);
    };
  };
```
    

í”„ë¡ íŠ¸ì—ì„œì˜ ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.  
    
<img src="./public/fetch-result.png" alt="" />

***

### ğŸ“† May 18, 2024
í—¤ë”ì˜ ê³µí†µ ë„¤ë¹„ê²Œì´ì…˜ì—ì„œ í˜„ì¬ ë©”ë‰´ì˜ í™œì„±í™” ìŠ¤íƒ€ì¼ ì ìš©  
React ì—ì„œëŠ” NavLink ë¥¼ ì´ìš©í•˜ë©´ ì‰½ê²Œ ì ìš©ì´ ë˜ì§€ë§Œ Next.js ì—ì„œëŠ” ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤.  
ê·¸ë˜ì„œ ì»¤ìŠ¤í…€ì„ í•´ì•¼ í•œë‹¤.
- 1ì°¨ ë°©ë²• : next/router ì˜ useRouter ë¥¼ ì´ìš©í•´ì„œ í˜„ì¬í˜ì´ì§€ì˜ pathname ì„ íŠ¹ì •í•´ì„œ ë¹„êµí•˜ëŠ” ë°©ë²•
- ë¨¼ì € ë©”ë‰´ì˜ ì •ë³´ì— ëŒ€í•œ ê°ì²´ ë°°ì—´ì„ ë§Œë“¤ì–´ ì£¼ê³ , 
```javascript
const menuData = [
    { id: "menu01", title: `${userName}`, path: "/member/mypage" },
    { id: "menu02", title: "Login", path: "/member/login" },
    { id: "menu03", title: "Sign up", path: "/member/join" },
];
```
- path ê°’ê³¼ í˜„ì¬ pathname ì„ ë¹„êµí•˜ì—¬ íŠ¹ì • ìŠ¤íƒ€ì¼ì„ ì ìš©í•œë‹¤.
```javascript
const router = useRouter();

{menuData.map((menuItem) => (
    <Link
        href={menuItem.path}
        className={`${menuItem.path === router.pathname ? "active" : ""}`}
    >
        {menuItem.title}
    </Link>
))}
```
ê·¸ëŸ°ë° ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ê°€ ëœ¬ë‹¤.  
<span style="color: red">Error: NextRouter was not mounted.</span>  
Next.js 13 ë¶€í„°ëŠ” next/router ëŒ€ì‹  next/navigation ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
```javascript
// refactor
import { usePathname } from "next/navigation";

const pathname = usePathname();

{menuData.map((menuItem) => (
    <Link
        href={menuItem.path}
        className={`${menuItem.path === pathname ? "active" : ""}`}
    >
        {menuItem.title}
    </Link>
))}
```  
ì°¸ê³  : https://nextjs.org/docs/app/api-reference/functions/use-router  

***  

 
### ğŸ“† May 16, 2024
#### Next.js App Router
Next.js 13 ë¶€í„° app/ ë””ë ‰í† ë¦¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¼ìš°íŒ…ì´ êµ¬ì„±ëœë‹¤.  
app/about ì´ë€ dir ë¥¼ ë§Œë“¤ê³  page.tsx ë¥¼ ìƒì„±í•˜ë©´ /about ì´ë€ route ê°€ êµ¬ì„±ì´ ë˜ëŠ” ê²ƒì´ë‹¤.  
Layout.tsx ë¡œ ë ˆì´ì•„ì›ƒì„ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤. /app/page.tsx ê°€ "/" ì´ë€ route ê°€ ëœë‹¤.  
Layout ì€ ì—¬ëŸ¬ ê²½ë¡œ ê°„ì— ê³µìœ ë˜ëŠ” UI ì´ë‹¤. Route ê°„ì˜ ì´ë™ ì‹œ ë ˆì´ì•„ì›ƒ ìƒíƒœë¥¼ ìœ ì§€í•˜ê³  ìƒí˜¸êµí™˜ ìƒíƒœë¥¼ ìœ ì§€í•˜ë©° ë¦¬ë Œë”ë§ ë˜ì§€ ì•ŠëŠ”ë‹¤.  
<img src="https://nextjs.org/_next/image?url=%2Fdocs%2Flight%2Flayout-special-file.png&w=3840&q=75" width="600">
```javascript
// app/layout.js
export default function RootLayout({
   children,
}: Readonly<{
    children: React.ReactNode;
}>) {
    return (
        <html lang="ko">
            <body>
                <Header />
                <Wrapper>{children}</Wrapper>
                <Footer />
            </body>
        </html>
    );
}

// app/page.js
export default function Page() {
  return <h1>Hello, World</h1>;
}
```
- /app/member/login/page.tsx : /member/login
- ì°¸ê³  : https://nextjs.org/docs/app/building-your-application/routing/layouts-and-templates

***  

### ğŸ“† May 13, 2024
- User ë°ì´í„° ëª¨ë¸ ìƒì„±
- /server/ ë‚´ì— routes, models, controller ë¥¼ ìƒì„±í•œë‹¤.
- routes/userRoutes.js ì— ë°±ì—”ë“œì—ì„œ ìš”ì²­ë°›ì„ routes ë¥¼ ì •ì˜í•œë‹¤.
```javascript
const router = express.Router();

router.route("/")
    .post(registerUser)
    .get(protect, admin)

router
    .post("/login", authUser)

router
    .route('/profile')
    .get(protect, getUserProfile)
    .put(protect, updateUserProfile)

router
    .route('/:id')
    .delete(protect, admin, deleteUser)
    .get(protect, admin, getUserById)
    .put(protect, admin, updateUser)
```
- models/userModel.js ì—ì„œ ìœ ì €ë°ì´í„° schema ë¥¼ êµ¬ì„±í•¨. 
```javascript
const userSchema = mongoose.Schema(
    {
        name: {
            type: String,
            required: true,
        },
        email: {
            type: String,
            required: true,
            unique: true,
        },
        password: {
            type: String,
            required: true,
        },
        isAdmin: {
            type: String,
            required: true,
            default: false,
        },
    },
    {
        timestamps: true,
    }
);

const User = mongoose.model("User", userSchema);

export default User;
// User model ì„ User ë¡œ ì •ì˜í•´ì„œ ë‚´ë³´ë‚¸ë‹¤
```
- controller/userController.js : registerUser í•¸ë“¤ëŸ¬ë¥¼ í†µí•´ userModel ì—ì„œ ê°€ì ¸ì˜¨ User ëª¨ë¸ì— ë§ì¶”ì–´ ì…ë ¥ë°›ì€ ìœ ì €ë°ì´í„°ë¥¼ ìƒì„±í•œë‹¤.
```javascript
const registerUser = asyncHandler(async (req, res) => {
    const { name, email, isAdmin, password } = req.body

    const userExists = await User.findOne({ email })

    if (userExists) {
        res.status(400)
        throw new Error('User already exists')
    }

    const user = await User.create({
        name,
        email,
        isAdmin,
        password,
    })

    if (user) {
        res.status(201).json({
            _id: user._id,
            name: user.name,
            email: user.email,
            isAdmin: user.isAdmin,
            token: generateToken(user._id),
        })
    } else {
        res.status(400)
        throw new Error('Invalid user data')
    }
});
```

***  

### ğŸ“† May 10, 2024
- ì„œë²„ìš”ì²­ ë°©ì‹ì„ async ë¡œ ë³€ê²½
- ì„œë²„ì‘ë‹µìƒíƒœì— ë”°ë¼ ì»¤ìŠ¤í…€ ë©”ì‹œì§€ ì ìš©
```javascript
const callDataHandler = async () => {
    try {
        const { data, status } = await axios.get("http://localhost:5500/getdata");

        if (status === 200) {
        console.log(data);
        setMsg(data);
        setCallStatus("suceess");
        }
    } catch(error: any) {
        console.log(error);
        setMsg("ì„œë²„ í†µì‹ ì„ ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.");
        setCallStatus("failed");
    };
};

<div>
    {msg && (callStatus === "suceess") ? <CallStackSuccess /> 
        : (callStatus === "failed") ? <CallStackFailed />
        : null
    }
</div>
```

***
  

### ğŸ“† May 8, 2024
- ë°±ì—”ë“œ í˜¸ì¶œ í…ŒìŠ¤íŠ¸
- ì´ë²¤íŠ¸í•¸ë“¤ëŸ¬ (callDataHandler) ë²„íŠ¼ì„ í†µí•´ì„œ ì„œë²„ìš”ì²­ì„ í…ŒìŠ¤íŠ¸

```javascript
// server.js ì¶”ê°€
server.get("/getdata", (req, res) => {
    res.send(`PORT: ${port} ì„œë²„ì—ì„œ ì •ìƒì ìœ¼ë¡œ ì‘ë‹µí•¨`);
});

//page.tsx
// ì„œë²„ í˜¸ì¶œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€
const callDataHandler = () => {
    axios.get("http://localhost:5500/getdata").then((res) => {
        console.log(res.data);
        setMsg(res.data);
    }).catch((error) => {
        console.log(error.message);
        setMsg(error.message);
    });
};


<button onClick={callDataHandler}>ë°ì´í„° ìš”ì²­</button>
```

ì„œë²„ ì‘ë‹µ ì„±ê³µ, ì‹¤íŒ¨
<img src="./public/ss-1.png" width="200" />
<img src="./public/ss-2.png" width="200" />

***

### ğŸ“† May 7, 2024
- í”„ë¡ íŠ¸, ë°±ì—”ë“œë¥¼ ê°™ì´ ê°™ì´ êµ¬ì„±í•˜ê¸°ë¡œ í•¨.
- src/server/ ì•ˆì— ì„œë²„ êµ¬ë™ì„ ìœ„í•œ íŒŒì¼ ìƒì„± (server.js)
- í”„ë¡ íŠ¸ port 3000, ë°±ì—”ë“œ port 5500
```javascript
//server.js
import express from "express";
import next from "next";

const dev = process.env.NODE_ENV !== "development";
const port = process.env.PORT || 5500;

const app = next({ dev, port });

const handle = app.getRequestHandler();

const isDate = new Date();

app.prepare().then(() => {
    const server = express();

    server.get("/", (req, res) => {
        res.send(
            `Running SERVER... ${isDate}`
        );
    });

    server.all("*", (req, res) => {
        return handle(req, res);
    });

    server.listen(port, () => {
        console.log(
            `Server running is ${process.env.NODE_ENV} mode on port ${port}`
        );
    });
});
```

- pscksge.json ìˆ˜ì •
```json
"scripts": {    
    "server": "nodemon src/server/server",
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
```
ì‹¤í–‰

```bash
npm run server

npm run dev
```

- ë¸Œë¼ìš°ì €ì—ì„œ [localhost:3000](http://localhost:3000), [localhost:5500](http://localhost:5500) ì„ ì—´ì–´ì„œ í™•ì¸

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```


```

point_app
â”œâ”€ public
â”‚  â”œâ”€ next.svg
â”‚  â””â”€ vercel.svg
â”œâ”€ src
â”‚  â”œâ”€ app
â”‚  â”‚  â”œâ”€ favicon.ico
â”‚  â”‚  â”œâ”€ globals.css
â”‚  â”‚  â”œâ”€ layout.tsx
â”‚  â”‚  â”œâ”€ page.module.css
â”‚  â”‚  â””â”€ page.tsx
â”‚  â””â”€ server
â”‚     â””â”€ server.js

```
